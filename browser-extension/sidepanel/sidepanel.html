<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workflow Recorder</title>
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <h1 class="logo">üé¨ Workflow Recorder</h1>
        <div class="connection-status">
          <div id="connectionIndicator" class="status-dot offline" title="Backend connection status"></div>
          <button id="settingsBtn" class="btn-icon" title="Settings">‚öôÔ∏è</button>
        </div>
      </div>
    </header>

    <!-- Main Content Container -->
    <main class="main-content">
      <!-- Recording View (shown when recording) -->
      <div id="recordingView" class="view hidden">
        <!-- Recording Controls -->
        <div class="recording-controls">
          <button id="startRecordBtn" class="btn btn-success btn-large">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7z"/>
            </svg>
            Start Recording
          </button>
          <div id="recordingButtons" class="btn-group hidden">
            <button id="pauseRecordBtn" class="btn btn-warning btn-icon-text">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
              </svg>
              Pause
            </button>
            <button id="stopRecordBtn" class="btn btn-danger btn-icon-text">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <rect x="6" y="6" width="12" height="12"/>
              </svg>
              Stop
            </button>
          </div>
        </div>

        <!-- Recording Status -->
        <div id="recordingStatus" class="status-card hidden">
          <div class="status-indicator">
            <div class="pulse-dot"></div>
            <span id="recordingText">Recording...</span>
          </div>
          <div class="status-stats">
            <div class="stat">
              <span class="stat-label">Duration</span>
              <span id="recordingDuration" class="stat-value">00:00</span>
            </div>
            <div class="stat">
              <span class="stat-label">Actions</span>
              <span id="actionCount" class="stat-value">0</span>
            </div>
          </div>
        </div>

        <!-- Current Page Info -->
        <div id="pageInfo" class="page-info hidden">
          <h3 class="section-title">Current Page</h3>
          <div class="page-details">
            <div class="page-title" id="pageTitle">‚Äî</div>
            <div class="page-url" id="pageUrl">‚Äî</div>
          </div>
        </div>

        <!-- Action List -->
        <div id="actionListContainer" class="action-list-container hidden">
          <h3 class="section-title">Recorded Actions</h3>
          <div id="actionList" class="action-list"></div>
        </div>
      </div>

      <!-- Browse View (default view) -->
      <div id="browseView" class="view">
        <!-- Search and Filter -->
        <div class="search-controls">
          <input
            type="text"
            id="searchInput"
            class="search-input"
            placeholder="Search workflows..."
          />
          <button id="newWorkflowBtn" class="btn btn-primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="8" x2="12" y2="16"/>
              <line x1="8" y1="12" x2="16" y2="12"/>
            </svg>
            New Recording
          </button>
        </div>

        <!-- Workflow List -->
        <div id="workflowListContainer" class="workflow-list-container">
          <div id="loadingSpinner" class="loading-spinner hidden">
            <div class="spinner"></div>
            <p>Loading workflows...</p>
          </div>
          <div id="workflowList" class="workflow-list"></div>
          <div id="emptyState" class="empty-state hidden">
            <div class="empty-icon">üìã</div>
            <h3>No workflows yet</h3>
            <p>Click "New Recording" to create your first workflow</p>
          </div>
        </div>

        <!-- Workflow Details Panel -->
        <div id="workflowDetails" class="workflow-details hidden">
          <div class="details-header">
            <button id="closeDetailsBtn" class="btn-icon">‚úï</button>
            <h2 id="detailsName" class="details-title"></h2>
          </div>
          <div class="details-body">
            <div class="details-meta">
              <div class="meta-item">
                <span class="meta-label">URL</span>
                <span id="detailsUrl" class="meta-value"></span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Actions</span>
                <span id="detailsActionCount" class="meta-value"></span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Success Rate</span>
                <span id="detailsSuccessRate" class="meta-value"></span>
              </div>
            </div>
            <div id="detailsTags" class="tags-container"></div>
            <div class="details-description">
              <h4>Description</h4>
              <p id="detailsDescription"></p>
            </div>
            <div class="details-actions-list">
              <h4>Actions</h4>
              <div id="detailsActionsList" class="action-items"></div>
            </div>
          </div>
          <div class="details-footer">
            <button id="replayBtn" class="btn btn-primary btn-large">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8 5v14l11-7z"/>
              </svg>
              Replay Workflow
            </button>
            <button id="deleteBtn" class="btn btn-danger">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
              </svg>
              Delete
            </button>
          </div>
        </div>
      </div>
    </main>

    <!-- Save Workflow Modal -->
    <div id="saveModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Save Workflow</h2>
          <button id="closeSaveModal" class="btn-icon">‚úï</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="workflowName">Name *</label>
            <input
              type="text"
              id="workflowName"
              class="input"
              placeholder="e.g., Login to Dashboard"
              required
            />
          </div>
          <div class="form-group">
            <label for="workflowDescription">Description</label>
            <textarea
              id="workflowDescription"
              class="textarea"
              placeholder="Optional description..."
              rows="3"
            ></textarea>
          </div>
          <div class="form-group">
            <label for="workflowTags">Tags</label>
            <input
              type="text"
              id="workflowTags"
              class="input"
              placeholder="e.g., login, auth, admin (comma-separated)"
            />
          </div>
          <div class="form-info">
            <p><strong>Actions:</strong> <span id="saveModalActionCount">0</span></p>
            <p><strong>Starting URL:</strong> <span id="saveModalUrl">‚Äî</span></p>
          </div>
          <div class="form-group">
            <button id="addExtractionBtn" class="btn btn-secondary" style="width: 100%;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10h-8V2h-2v8H3v2h8v8h2v-8h8z"/>
              </svg>
              Add Data Extraction
            </button>
            <p class="text-sm text-gray-500 mt-2">
              Optionally add an extraction point to capture data from the last step
            </p>
          </div>
        </div>
        <div class="modal-footer">
          <button id="cancelSaveBtn" class="btn btn-secondary">Cancel</button>
          <button id="confirmSaveBtn" class="btn btn-success">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              <polyline points="17 21 17 13 7 13 7 21"/>
              <polyline points="7 3 7 8 15 8"/>
            </svg>
            Save Workflow
          </button>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Settings</h2>
          <button id="closeSettingsModal" class="btn-icon">‚úï</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="backendUrl">Backend API URL *</label>
            <input
              type="url"
              id="backendUrl"
              class="input"
              placeholder="http://localhost:8080/api/v1"
              required
            />
            <p class="text-sm text-gray-500 mt-2">
              The URL of your backend API. Change this if your backend is hosted remotely.
            </p>
          </div>
          <div class="form-info">
            <p><strong>Default:</strong> http://localhost:8080/api/v1</p>
            <p><strong>Example (hosted):</strong> https://api.example.com/api/v1</p>
          </div>
        </div>
        <div class="modal-footer">
          <button id="resetSettingsBtn" class="btn btn-secondary">Reset to Default</button>
          <button id="saveSettingsBtn" class="btn btn-success">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              <polyline points="17 21 17 13 7 13 7 21"/>
              <polyline points="7 3 7 8 15 8"/>
            </svg>
            Save Settings
          </button>
        </div>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>
  </div>

  <!-- Scripts -->
  <script type="module" src="sidepanel.js"></script>
</body>
</html>
